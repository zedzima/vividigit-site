# Local Web CMS — Design Document

## Overview

Локальный веб-интерфейс для управления контентом CMS Vividigit. Работает на localhost, редактирует существующие TOML файлы, использует текущий генератор для сборки.

## Goals

- Удобное редактирование страниц через формы вместо ручного TOML
- Сборка новых страниц из библиотеки блоков
- Управление медиа-файлами
- Превью и публикация в один клик

## Non-Goals (MVP)

- Авторизация (localhost = безопасно)
- База данных (всё хранится в TOML)
- Мультиязычный интерфейс
- Облачный хостинг CMS

## Architecture

```
src/
├── main.py           # точка входа, генератор
├── generator.py      # рендеринг HTML
├── parser.py         # парсинг TOML
└── cms_server.py     # NEW: веб-интерфейс

templates/
├── blocks/           # шаблоны блоков (существует)
├── layouts/          # layouts (существует)
└── cms/              # NEW: шаблоны админки
    ├── base.html
    ├── pages.html
    ├── editor.html
    ├── media.html
    └── settings.html
```

## API Endpoints

```
GET  /                    # Dashboard — список страниц
GET  /pages/new           # Форма создания страницы
POST /pages/create        # Создать страницу (выбор блоков → TOML)
GET  /pages/edit/<path>   # Редактор страницы
POST /pages/save/<path>   # Сохранить изменения в TOML
POST /pages/delete/<path> # Удалить страницу

GET  /media               # Медиа-библиотека
POST /media/upload        # Загрузить файл

GET  /settings            # Редактор site.toml
POST /settings/save       # Сохранить настройки

POST /preview             # Сгенерировать превью
POST /publish             # Генерация + git push
```

## User Interface

### 1. Dashboard (список страниц)

```
┌─────────────────────────────────────────────────────────┐
│  CMS Vividigit                    [Настройки] [Медиа]   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  Страницы:                         [+ Новая страница]   │
│                                                         │
│  /                     Главная              [Править]   │
│  /services             Услуги               [Править]   │
│  /services/ai-opt...   AI Optimisation      [Править]   │
│  /blog                 Блог                 [Править]   │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  [Перегенерировать сайт]          [Опубликовать]        │
└─────────────────────────────────────────────────────────┘
```

### 2. Создание страницы

```
┌─────────────────────────────────────────────────────────┐
│  Создать новую страницу                                 │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  URL: /services/ [_______________]                      │
│  Заголовок: [___________________________]               │
│                                                         │
│  Выберите блоки:                                        │
│  ☐ hero         — заголовок с кнопкой                   │
│  ☐ hero_split   — заголовок + картинка                  │
│  ☐ features     — список преимуществ                    │
│  ☐ process      — этапы работы                          │
│  ☐ pricing      — тарифы                                │
│  ☐ faq          — вопросы-ответы                        │
│  ☐ cta          — призыв к действию                     │
│  ...                                                    │
│                                                         │
│                              [Создать страницу]         │
└─────────────────────────────────────────────────────────┘
```

### 3. Редактор страницы

```
┌─────────────────────────────────────────────────────────┐
│  Редактирование: /services/ai-optimisation              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─ hero ─────────────────────────────────────────────┐ │
│  │ title: [____________________________________]      │ │
│  │ subtitle: [_________________________________]      │ │
│  │ button.label: [____________]                       │ │
│  │ button.url: [Выберите страницу...           ▼]     │ │
│  │                                    [Удалить блок]  │ │
│  └────────────────────────────────────────────────────┘ │
│                                                         │
│  ┌─ features ─────────────────────────────────────────┐ │
│  │ ...                                                │ │
│  └────────────────────────────────────────────────────┘ │
│                                                         │
│  [+ Добавить блок]                                      │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  [Сохранить]    [Превью]    [Опубликовать]              │
└─────────────────────────────────────────────────────────┘
```

### 4. Медиа-библиотека

```
┌─────────────────────────────────────────────────────────┐
│  Медиа                                 [Загрузить файл] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  📁 images/site/                                        │
│     logo.svg  favicon.png                               │
│                                                         │
│  📁 images/services/                                    │
│     seo-hero.jpg  ai-diagram.png                        │
│                                                         │
│  📁 logos/                                              │
│     google.svg  meta.svg  amazon.svg                    │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## Key Features

### Автоматические формы из demo-файлов

CMS читает структуру блока из `content/blocks/<block>/<block>.en.toml` и генерирует форму автоматически. Demo-файлы служат схемой данных.

### Перелинковка через UI

Поля с URL показывают выпадающий список:
- Все страницы сайта (из content/)
- Якоря текущей страницы (#section)
- Опция "внешняя ссылка" (ввод https://...)

### Превью

1. Сохраняет текущие изменения во временный TOML
2. Запускает генератор для одной страницы
3. Открывает результат в новой вкладке

### Публикация

1. Запускает полную генерацию сайта
2. `git add public/`
3. `git commit -m "Update content"`
4. `git push`

## Workflow

### Разработчик
1. Создаёт шаблоны блоков
2. Настраивает структуру сайта
3. Деплоит на GitHub Pages

### Контент-менеджер
1. `git pull` — получить свежую версию
2. `python src/cms_server.py` — запустить CMS
3. Открыть `localhost:8000`
4. Редактировать/создавать страницы
5. Превью → проверить результат
6. Опубликовать → автоматический деплой

## Technical Decisions

- **Framework:** Flask (минимальный, достаточно для задачи)
- **Templates:** Jinja2 (уже используется в проекте)
- **Styles:** Простой CSS, без фреймворков
- **JS:** Минимальный, только для динамических форм
- **Storage:** TOML файлы (без БД)

## File Changes

### New Files
- `src/cms_server.py` — основной сервер
- `templates/cms/*.html` — шаблоны админки
- `static/cms/style.css` — стили админки
- `static/cms/script.js` — скрипты (минимум)

### Modified Files
- `parser.py` — добавить функцию записи TOML (если нет)

## Future Improvements (post-MVP)

- Drag-and-drop сортировка блоков
- Визуальный превью в редакторе (iframe)
- История изменений (git log)
- Мультиязычность контента (переключение en/de/ru)
